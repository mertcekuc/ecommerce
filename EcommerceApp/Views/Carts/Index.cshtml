@model EcommerceApp.Models.Cart

@{
    ViewData["Title"] = "Cart";
    var imageLoaded = false;
    string[] extensions = { ".jpg", ".jpeg", ".png", ".gif" };
}

<style>
    .product-icon {
        height: 50px; /* Adjust the height as needed */
        object-fit: cover; /* Ensures the image covers the specified dimensions */
        /*move image to center of cell*/
        margin:auto;

    }
    .form-inline .form-control {
        width: 80px; /* Ensure the input field has a consistent width */
    }
    .btn-update {
        margin-left: 10px;
    }
    .table th, .table td {
        vertical-align: middle; /* Vertically align table content */
        text-align: center; /* Horizontally center table content */
        padding: auto;
    }
    .table td img {
        max-height: 100px; /* Ensure image fits in the cell */
        object-fit: cover;
    }
    .update-quantity input{
        margin: auto;
        padding: auto;
        margin-bottom:5px;
        
	}
    

</style>

<div class="container mt-4">
    <h1 class="mb-4">Shopping Cart</h1>

    <a asp-controller="Carts" asp-action="EmptyCart" class="btn btn-warning mb-3">
        <i class="bi bi-trash"></i> Empty Cart
    </a>

    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Product Image</th>
                <th scope="col">Product Name</th>
                <th scope="col">Quantity</th>
                <th scope="col">Price</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            @{
                decimal total = 0;
                int quantity = 0;
            }
            @foreach (var item in Model.CartDetails)
            {
                    <tr>
                        <td>
                        @foreach (var extension in extensions)
                        {
                            if (!imageLoaded)
                            {
                                            <img src="~/img/Products/@($"{item.ProductId}{extension}")"
                                                 alt="@item.Product.Name"
                                                 class="product-icon img-fluid rounded"
                                                 onerror="this.style.display='none';"
                                                 onload="this.style.display='block'; imageLoaded=true;" />
                            }
                        }
                        </td>
                        <td>
                        @Html.DisplayFor(modelItem => item.Product.Name)
                        </td>
                        <td>
                            <div class="update-quantity">
                            <form asp-controller="Carts" asp-action="UpdateQuantity" method="post" class="form-inline">
                                <input type="hidden" name="cartDetailId" value="@item.Id" />
                                <input type="number" min="1" max="10" name="quantity" value="@item.Quantity" class="form-control form-control-sm" placeholder="Quantity" />
                                <button type="submit" class="btn btn-primary btn-sm btn-update">Update</button>
                            </form></div>
                        @{
                            quantity += item.Quantity;
                        }
                        </td>
                        <td>
                        @((item.Price * item.Quantity).ToString("C2", System.Globalization.CultureInfo.CurrentCulture))
                        @{
                            total += item.Price * item.Quantity;
                        }
                        </td>
                        <td>
                            <a asp-controller="Carts" asp-action="RemoveFromCart" asp-route-cartDetailId="@item.Id" class="btn btn-danger btn-sm">
                                <i class="bi bi-x-circle"></i> Remove
                            </a>
                        </td>
                    </tr>
            }
            <tr>
                <td><strong>Total:</strong></td>
                <td></td>
                <td>@quantity</td>
                <td>@total.ToString("C2", System.Globalization.CultureInfo.CurrentCulture)</td>
                <td></td>
            </tr>
        </tbody>
    </table>
</div>

@section Scripts {
        <!-- Add Bootstrap Icons CDN for icon usage -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" />
}
